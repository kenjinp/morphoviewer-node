{"version":3,"file":"codecutils.umd.js","sources":["../node_modules/rollup-plugin-node-globals/src/global.js","../node_modules/traverse/index.js","../src/main.js"],"sourcesContent":["export default typeof global !== \"undefined\" ? global :\n            typeof self !== \"undefined\" ? self :\n            typeof window !== \"undefined\" ? window : {}\n","var traverse = module.exports = function (obj) {\n    return new Traverse(obj);\n};\n\nfunction Traverse (obj) {\n    this.value = obj;\n}\n\nTraverse.prototype.get = function (ps) {\n    var node = this.value;\n    for (var i = 0; i < ps.length; i ++) {\n        var key = ps[i];\n        if (!node || !hasOwnProperty.call(node, key)) {\n            node = undefined;\n            break;\n        }\n        node = node[key];\n    }\n    return node;\n};\n\nTraverse.prototype.has = function (ps) {\n    var node = this.value;\n    for (var i = 0; i < ps.length; i ++) {\n        var key = ps[i];\n        if (!node || !hasOwnProperty.call(node, key)) {\n            return false;\n        }\n        node = node[key];\n    }\n    return true;\n};\n\nTraverse.prototype.set = function (ps, value) {\n    var node = this.value;\n    for (var i = 0; i < ps.length - 1; i ++) {\n        var key = ps[i];\n        if (!hasOwnProperty.call(node, key)) node[key] = {};\n        node = node[key];\n    }\n    node[ps[i]] = value;\n    return value;\n};\n\nTraverse.prototype.map = function (cb) {\n    return walk(this.value, cb, true);\n};\n\nTraverse.prototype.forEach = function (cb) {\n    this.value = walk(this.value, cb, false);\n    return this.value;\n};\n\nTraverse.prototype.reduce = function (cb, init) {\n    var skip = arguments.length === 1;\n    var acc = skip ? this.value : init;\n    this.forEach(function (x) {\n        if (!this.isRoot || !skip) {\n            acc = cb.call(this, acc, x);\n        }\n    });\n    return acc;\n};\n\nTraverse.prototype.paths = function () {\n    var acc = [];\n    this.forEach(function (x) {\n        acc.push(this.path); \n    });\n    return acc;\n};\n\nTraverse.prototype.nodes = function () {\n    var acc = [];\n    this.forEach(function (x) {\n        acc.push(this.node);\n    });\n    return acc;\n};\n\nTraverse.prototype.clone = function () {\n    var parents = [], nodes = [];\n    \n    return (function clone (src) {\n        for (var i = 0; i < parents.length; i++) {\n            if (parents[i] === src) {\n                return nodes[i];\n            }\n        }\n        \n        if (typeof src === 'object' && src !== null) {\n            var dst = copy(src);\n            \n            parents.push(src);\n            nodes.push(dst);\n            \n            forEach(objectKeys(src), function (key) {\n                dst[key] = clone(src[key]);\n            });\n            \n            parents.pop();\n            nodes.pop();\n            return dst;\n        }\n        else {\n            return src;\n        }\n    })(this.value);\n};\n\nfunction walk (root, cb, immutable) {\n    var path = [];\n    var parents = [];\n    var alive = true;\n    \n    return (function walker (node_) {\n        var node = immutable ? copy(node_) : node_;\n        var modifiers = {};\n        \n        var keepGoing = true;\n        \n        var state = {\n            node : node,\n            node_ : node_,\n            path : [].concat(path),\n            parent : parents[parents.length - 1],\n            parents : parents,\n            key : path.slice(-1)[0],\n            isRoot : path.length === 0,\n            level : path.length,\n            circular : null,\n            update : function (x, stopHere) {\n                if (!state.isRoot) {\n                    state.parent.node[state.key] = x;\n                }\n                state.node = x;\n                if (stopHere) keepGoing = false;\n            },\n            'delete' : function (stopHere) {\n                delete state.parent.node[state.key];\n                if (stopHere) keepGoing = false;\n            },\n            remove : function (stopHere) {\n                if (isArray(state.parent.node)) {\n                    state.parent.node.splice(state.key, 1);\n                }\n                else {\n                    delete state.parent.node[state.key];\n                }\n                if (stopHere) keepGoing = false;\n            },\n            keys : null,\n            before : function (f) { modifiers.before = f },\n            after : function (f) { modifiers.after = f },\n            pre : function (f) { modifiers.pre = f },\n            post : function (f) { modifiers.post = f },\n            stop : function () { alive = false },\n            block : function () { keepGoing = false }\n        };\n        \n        if (!alive) return state;\n        \n        function updateState() {\n            if (typeof state.node === 'object' && state.node !== null) {\n                if (!state.keys || state.node_ !== state.node) {\n                    state.keys = objectKeys(state.node)\n                }\n                \n                state.isLeaf = state.keys.length == 0;\n                \n                for (var i = 0; i < parents.length; i++) {\n                    if (parents[i].node_ === node_) {\n                        state.circular = parents[i];\n                        break;\n                    }\n                }\n            }\n            else {\n                state.isLeaf = true;\n                state.keys = null;\n            }\n            \n            state.notLeaf = !state.isLeaf;\n            state.notRoot = !state.isRoot;\n        }\n        \n        updateState();\n        \n        // use return values to update if defined\n        var ret = cb.call(state, state.node);\n        if (ret !== undefined && state.update) state.update(ret);\n        \n        if (modifiers.before) modifiers.before.call(state, state.node);\n        \n        if (!keepGoing) return state;\n        \n        if (typeof state.node == 'object'\n        && state.node !== null && !state.circular) {\n            parents.push(state);\n            \n            updateState();\n            \n            forEach(state.keys, function (key, i) {\n                path.push(key);\n                \n                if (modifiers.pre) modifiers.pre.call(state, state.node[key], key);\n                \n                var child = walker(state.node[key]);\n                if (immutable && hasOwnProperty.call(state.node, key)) {\n                    state.node[key] = child.node;\n                }\n                \n                child.isLast = i == state.keys.length - 1;\n                child.isFirst = i == 0;\n                \n                if (modifiers.post) modifiers.post.call(state, child);\n                \n                path.pop();\n            });\n            parents.pop();\n        }\n        \n        if (modifiers.after) modifiers.after.call(state, state.node);\n        \n        return state;\n    })(root).node;\n}\n\nfunction copy (src) {\n    if (typeof src === 'object' && src !== null) {\n        var dst;\n        \n        if (isArray(src)) {\n            dst = [];\n        }\n        else if (isDate(src)) {\n            dst = new Date(src.getTime ? src.getTime() : src);\n        }\n        else if (isRegExp(src)) {\n            dst = new RegExp(src);\n        }\n        else if (isError(src)) {\n            dst = { message: src.message };\n        }\n        else if (isBoolean(src)) {\n            dst = new Boolean(src);\n        }\n        else if (isNumber(src)) {\n            dst = new Number(src);\n        }\n        else if (isString(src)) {\n            dst = new String(src);\n        }\n        else if (Object.create && Object.getPrototypeOf) {\n            dst = Object.create(Object.getPrototypeOf(src));\n        }\n        else if (src.constructor === Object) {\n            dst = {};\n        }\n        else {\n            var proto =\n                (src.constructor && src.constructor.prototype)\n                || src.__proto__\n                || {}\n            ;\n            var T = function () {};\n            T.prototype = proto;\n            dst = new T;\n        }\n        \n        forEach(objectKeys(src), function (key) {\n            dst[key] = src[key];\n        });\n        return dst;\n    }\n    else return src;\n}\n\nvar objectKeys = Object.keys || function keys (obj) {\n    var res = [];\n    for (var key in obj) res.push(key)\n    return res;\n};\n\nfunction toS (obj) { return Object.prototype.toString.call(obj) }\nfunction isDate (obj) { return toS(obj) === '[object Date]' }\nfunction isRegExp (obj) { return toS(obj) === '[object RegExp]' }\nfunction isError (obj) { return toS(obj) === '[object Error]' }\nfunction isBoolean (obj) { return toS(obj) === '[object Boolean]' }\nfunction isNumber (obj) { return toS(obj) === '[object Number]' }\nfunction isString (obj) { return toS(obj) === '[object String]' }\n\nvar isArray = Array.isArray || function isArray (xs) {\n    return Object.prototype.toString.call(xs) === '[object Array]';\n};\n\nvar forEach = function (xs, fn) {\n    if (xs.forEach) return xs.forEach(fn)\n    else for (var i = 0; i < xs.length; i++) {\n        fn(xs[i], i, xs);\n    }\n};\n\nforEach(objectKeys(Traverse.prototype), function (key) {\n    traverse[key] = function (obj) {\n        var args = [].slice.call(arguments, 1);\n        var t = new Traverse(obj);\n        return t[key].apply(t, args);\n    };\n});\n\nvar hasOwnProperty = Object.hasOwnProperty || function (obj, key) {\n    return key in obj;\n};\n","import traverse from \"traverse\";\n\n/**\n* The CodecUtils class gather some static methods that can be useful while\n* encodeing/decoding data.\n* CodecUtils does not have a constructor, don't try to instanciate it.\n*/\nclass CodecUtils {\n\n\n  /**\n  * Get whether or not the platform is using little endian.\n  * @return {Boolen } true if the platform is little endian, false if big endian\n  */\n  static isPlatformLittleEndian() {\n    var a = new Uint32Array([0x12345678]);\n    var b = new Uint8Array(a.buffer, a.byteOffset, a.byteLength);\n    return (b[0] != 0x12);\n  }\n\n\n  /**\n  * convert an ArrayBuffer into a unicode string (2 bytes for each char)\n  * Note: this method was kindly borrowed from Google Closure Compiler:\n  * https://github.com/google/closure-library/blob/master/closure/goog/crypt/crypt.js\n  * @param {ArrayBuffer} buf - input ArrayBuffer\n  * @return {String} a string compatible with Unicode characters\n  */\n  static arrayBufferToUnicode( buff ) {\n    var buffUint8 = new Uint8Array(buff)\n    var out = [], pos = 0, c = 0;\n\n    while (pos < buffUint8.length) {\n      var c1 = buffUint8[pos++];\n      if (c1 < 128) {\n        if((c1 < 32 && c1 != 10 && c1 != 13 && c1 != 9) || c1 == 127){\n          console.warn(\"Invalid string: non-printable characters\");\n          return null;\n        }\n        out[c++] = String.fromCharCode(c1);\n      } else if (c1 > 191 && c1 < 224) {\n        var c2 = buffUint8[pos++];\n        out[c++] = String.fromCharCode((c1 & 31) << 6 | c2 & 63);\n      } else if (c1 > 239 && c1 < 365) {\n        // Surrogate Pair\n        var c2 = buffUint8[pos++];\n        var c3 = buffUint8[pos++];\n        var c4 = buffUint8[pos++];\n        var u = ((c1 & 7) << 18 | (c2 & 63) << 12 | (c3 & 63) << 6 | c4 & 63) - 0x10000;\n        out[c++] = String.fromCharCode(0xD800 + (u >> 10));\n        out[c++] = String.fromCharCode(0xDC00 + (u & 1023));\n      } else {\n        var c2 = buffUint8[pos++];\n        var c3 = buffUint8[pos++];\n        var code = (c1 & 15) << 12 | (c2 & 63) << 6 | c3 & 63;\n        if(code === 0xFFFD){\n          console.warn(\"Invalid string: a REPLACEMENT CHARACTER was spotted\");\n          return null;\n        }\n        out[c++] = String.fromCharCode(code);\n      }\n    }\n    return out.join('');\n  };\n\n\n  /**\n  * convert a unicode string into an ArrayBuffer\n  * Note that the str is a regular string but it will be encoded with\n  * 2 bytes per char instead of 1 ( ASCII uses 1 byte/char ).\n  * Note: this method was kindly borrowed from Google Closure Compiler:\n  * https://github.com/google/closure-library/blob/master/closure/goog/crypt/crypt.js\n  * @param {String} str - string to encode\n  * @return {ArrayBuffer} the output ArrayBuffer\n  */\n  static unicodeToArrayBuffer( str ) {\n    var out = [], p = 0;\n    for (var i = 0; i < str.length; i++) {\n      var c = str.charCodeAt(i);\n      if (c < 128) {\n        out[p++] = c;\n      } else if (c < 2048) {\n        out[p++] = (c >> 6) | 192;\n        out[p++] = (c & 63) | 128;\n      } else if (\n          ((c & 0xFC00) == 0xD800) && (i + 1) < str.length &&\n          ((str.charCodeAt(i + 1) & 0xFC00) == 0xDC00)) {\n        // Surrogate Pair\n        c = 0x10000 + ((c & 0x03FF) << 10) + (str.charCodeAt(++i) & 0x03FF);\n        out[p++] = (c >> 18) | 240;\n        out[p++] = ((c >> 12) & 63) | 128;\n        out[p++] = ((c >> 6) & 63) | 128;\n        out[p++] = (c & 63) | 128;\n      } else {\n        out[p++] = (c >> 12) | 224;\n        out[p++] = ((c >> 6) & 63) | 128;\n        out[p++] = (c & 63) | 128;\n      }\n    }\n\n    // make a buffer out of the array\n    return new Uint8Array(out).buffer;\n  };\n\n\n  /**\n  * Convert an ArrayBuffer into a ASCII string (1 byte for each char)\n  * @param {ArrayBuffer} buf - buffer to convert into ASCII string\n  * @return {String} the output string\n  */\n  static arrayBufferToString8( buf ) {\n    return String.fromCharCode.apply(null, new Uint8Array(buf));\n  }\n\n\n  /**\n  * Convert a ASCII string into an ArrayBuffer.\n  * Note that the str is a regular string, it will be encoded with 1 byte per char\n  * @param {String} str - string to encode\n  * @return {ArrayBuffer}\n  */\n  static string8ToArrayBuffer( str ) {\n    var buf = new ArrayBuffer(str.length);\n    var bufView = new Uint8Array(buf);\n    for (var i=0; i < str.length; i++) {\n      bufView[i] = str.charCodeAt(i);\n    }\n    return buf;\n  }\n\n\n  /**\n  * Write a ASCII string into a buffer\n  * @param {String} str - a string that contains only ASCII characters\n  * @param {ArrayBuffer} buffer - the buffer where to write the string\n  * @param {Number} byteOffset - the offset to apply, in number of bytes\n  */\n  static setString8InBuffer( str, buffer, byteOffset = 0 ){\n    if( byteOffset < 0){\n      console.warn(\"The byte offset cannot be negative.\");\n      return;\n    }\n\n    if( !buffer || !(buffer instanceof ArrayBuffer)){\n      console.warn(\"The buffer must be a valid ArrayBuffer.\");\n      return;\n    }\n\n    if( (str.length + byteOffset) > buffer.byteLength ){\n      console.warn(\"The string is too long to be writen in this buffer.\");\n      return;\n    }\n\n    var bufView = new Uint8Array(buffer);\n\n    for (var i=0; i < str.length; i++) {\n      bufView[i + byteOffset] = str.charCodeAt(i);\n    }\n  }\n\n\n  /**\n  * Extract an ASCII string from an ArrayBuffer\n  * @param {ArrayBuffer} buffer - the buffer\n  * @param {Number} strLength - number of chars in the string we want\n  * @param {Number} byteOffset - the offset in number of bytes\n  * @return {String} the string, or null in case of error\n  */\n  static getString8FromBuffer( buffer, strLength, byteOffset=0 ){\n    if( byteOffset < 0){\n      console.warn(\"The byte offset cannot be negative.\");\n      return null;\n    }\n\n    if( !buffer || !(buffer instanceof ArrayBuffer)){\n      console.warn(\"The buffer must be a valid ArrayBuffer.\");\n      return null;\n    }\n\n    if( (strLength + byteOffset) > buffer.byteLength ){\n      console.warn(\"The string is too long to be writen in this buffer.\");\n      return null;\n    }\n\n    return String.fromCharCode.apply(null, new Uint8Array(buffer, byteOffset, strLength));\n  }\n\n\n  /**\n  * Serializes a JS object into an ArrayBuffer.\n  * This is using a unicode JSON intermediate step.\n  * @param {Object} obj - an object that does not have cyclic structure\n  * @return {ArrayBuffer} the serialized output\n  */\n  static objectToArrayBuffer( obj ){\n    var buff = null;\n    var objCleanClone = CodecUtils.makeSerializeFriendly(obj)\n\n    try{\n      var strObj = JSON.stringify( objCleanClone );\n      buff = CodecUtils.unicodeToArrayBuffer(strObj)\n    }catch(e){\n      console.warn(e);\n    }\n\n    return buff;\n  }\n\n\n  /**\n  * Convert an ArrayBuffer into a JS Object. This uses an intermediate unicode JSON string.\n  * Of course, this buffer has to come from a serialized object.\n  * @param {ArrayBuffer} buff - the ArrayBuffer that hides some object\n  * @return {Object} the deserialized object\n  */\n  static ArrayBufferToObject( buff ){\n    var obj = null;\n\n    try{\n      var strObj = CodecUtils.arrayBufferToUnicode( buff );\n      obj = JSON.parse( strObj )\n    }catch(e){\n      console.warn(e);\n    }\n\n    return obj;\n  }\n\n\n  /**\n  * Get if wether of not the arg is a typed array\n  * @param {Object} obj - possibly a typed array, or maybe not\n  * @return {Boolean} true if obj is a typed array\n  */\n  static isTypedArray( obj ){\n    return ( obj instanceof Int8Array         ||\n             obj instanceof Uint8Array        ||\n             obj instanceof Uint8ClampedArray ||\n             obj instanceof Int16Array        ||\n             obj instanceof Uint16Array       ||\n             obj instanceof Int32Array        ||\n             obj instanceof Uint32Array       ||\n             obj instanceof Float32Array      ||\n             obj instanceof Float64Array )\n  }\n\n\n  /**\n  * Merge some ArrayBuffes in a single one\n  * @param {Array} arrayOfBuffers - some ArrayBuffers\n  * @return {ArrayBuffer} the larger merged buffer\n  */\n  static mergeBuffers( arrayOfBuffers ){\n    var totalByteSize = 0;\n\n    for(var i=0; i<arrayOfBuffers.length; i++){\n      totalByteSize += arrayOfBuffers[i].byteLength;\n    }\n\n    var concatArray = new Uint8Array( totalByteSize );\n\n    var offset = 0\n    for(var i=0; i<arrayOfBuffers.length; i++){\n      concatArray.set( new Uint8Array(arrayOfBuffers[i]), offset);\n      offset += arrayOfBuffers[i].byteLength\n    }\n\n    return concatArray.buffer;\n  }\n\n\n  /**\n  * In a browser, the global object is `window` while in Node, it's `GLOBAL`.\n  * This method return the one that is relevant to the execution context.\n  * @return {Object} the global object\n  */\n  static getGlobalObject(){\n    var constructorHost = null;\n\n    try{\n      constructorHost = window; // in a web browser\n    }catch( e ){\n      try{\n        constructorHost = global; // in node\n      }catch( e ){\n        console.warn( \"You are not in a Javascript environment?? Weird.\" );\n        return null;\n      }\n    }\n    return constructorHost;\n  }\n\n\n  /**\n  * Extract a typed array from an arbitrary buffer, with an arbitrary offset\n  * @param {ArrayBuffer} buffer - the buffer from which we extract data\n  * @param {Number} byteOffset - offset from the begining of buffer\n  * @param {Function} arrayType - function object, actually the constructor of the output array\n  * @param {Number} numberOfElements - nb of elem we want to fetch from the buffer\n  * @return {TypedArray} output of type given by arg arrayType - this is a copy, not a view\n  */\n  static extractTypedArray( buffer, byteOffset, arrayType, numberOfElements ){\n    if( !buffer ){\n      console.warn(\"Input Buffer is null.\");\n      return null;\n    }\n\n    if(! (buffer instanceof ArrayBuffer) ){\n      console.warn(\"Buffer must be of type ArrayBuffer\");\n      return null;\n    }\n\n    if(numberOfElements <= 0){\n      console.warn(\"The number of elements to fetch must be greater than 0\");\n      return null;\n    }\n\n    if(byteOffset < 0){\n      console.warn(\"The byte offset must be possitive or 0\");\n      return null;\n    }\n\n    if( byteOffset >= buffer.byteLength ){\n      console.warn(\"The offset cannot be larger than the size of the buffer.\");\n      return null;\n    }\n\n    if( arrayType instanceof Function && !(\"BYTES_PER_ELEMENT\" in arrayType)){\n      console.warn(\"ArrayType must be a typed array constructor function.\");\n      return null;\n    }\n\n    if( arrayType.BYTES_PER_ELEMENT * numberOfElements + byteOffset > buffer.byteLength ){\n      console.warn(\"The requested number of elements is too large for this buffer\");\n      return;\n    }\n\n    var slicedBuff = buffer.slice(byteOffset, byteOffset + numberOfElements*arrayType.BYTES_PER_ELEMENT)\n    return new arrayType( slicedBuff )\n  }\n\n\n  /**\n  * Get some info about the given TypedArray\n  * @param {TypedArray} typedArray - one of the typed array\n  * @return {Object} in form of {type: String, signed: Boolean, bytesPerElements: Number, byteLength: Number, length: Number}\n  */\n  static getTypedArrayInfo( typedArray ){\n    var type = null;\n    var signed = false;\n\n    if( typedArray instanceof Int8Array ){\n      type = \"int\";\n      signed = false;\n    }else if( typedArray instanceof Uint8Array ){\n      type = \"int\";\n      signed = true;\n    }else if( typedArray instanceof Uint8ClampedArray ){\n      type = \"int\";\n      signed = true;\n    }else if( typedArray instanceof Int16Array ){\n      type = \"int\";\n      signed = false;\n    }else if( typedArray instanceof Uint16Array ){\n      type = \"int\";\n      signed = true;\n    }else if( typedArray instanceof Int32Array ){\n      type = \"int\";\n      signed = false;\n    }else if( typedArray instanceof Uint32Array ){\n      type = \"int\";\n      signed = true;\n    }else if( typedArray instanceof Float32Array ){\n      type = \"float\";\n      signed = false;\n    }else if( typedArray instanceof Float64Array ){\n      type = \"float\";\n      signed = false;\n    }\n\n    return {\n      type: type,\n      signed: signed,\n      bytesPerElements: typedArray.BYTES_PER_ELEMENT,\n      byteLength: typedArray.byteLength,\n      length: typedArray.length\n    }\n  }\n\n\n  /**\n  * Counts the number of typed array obj has as attributes\n  * @param {Object} obj - an Object\n  * @return {Number} the number of typed array\n  */\n  static howManyTypedArrayAttributes( obj ){\n    var typArrCounter = 0;\n    traverse(obj).forEach(function (x) {\n      typArrCounter += CodecUtils.isTypedArray(x);\n    });\n    return typArrCounter;\n  }\n\n\n  /**\n  * Check if the given object contains any circular reference.\n  * (Circular ref are non serilizable easily, we want to spot them)\n  * @param {Object} obj - An object to check\n  * @return {Boolean} true if obj contains circular refm false if not\n  */\n  static hasCircularReference( obj ){\n    var hasCircular = false;\n    traverse(obj).forEach(function (x) {\n      if (this.circular){\n        hasCircular = true;\n      }\n    });\n    return hasCircular;\n  }\n\n\n  /**\n  * Remove circular dependencies from an object and return a circularRef-free version\n  * of the object (does not change the original obj), of null if no circular ref was found\n  * @param {Object} obj - An object to check\n  * @return {Object} a circular-ref free object copy if any was found, or null if no circ was found\n  */\n  static removeCircularReference( obj ){\n    var hasCircular = false;\n    var noCircRefObj = traverse(obj).map(function (x) {\n      if (this.circular){\n        this.remove();\n        hasCircular = true;\n      }\n    });\n    return hasCircular ? noCircRefObj : null;\n  }\n\n\n  /**\n  * Clone the object and replace the typed array attributes by regular Arrays.\n  * @param {Object} obj - an object to alter\n  * @return {Object} the clone if ant typed array were changed, or null if was obj didnt contain any typed array.\n  */\n  static replaceTypedArrayAttributesByArrays( obj ){\n    var hasTypedArray = false;\n\n    var noTypedArrClone = traverse(obj).map(function (x) {\n      if (CodecUtils.isTypedArray(x)){\n        // here, we cannot call .length directly because traverse.map already serialized\n        // typed arrays into regular objects\n        var origSize = Object.keys(x).length;\n        var untypedArray = new Array( origSize );\n\n        for(var i=0; i<origSize; i++){\n          untypedArray[i] = x[i];\n        }\n        this.update( untypedArray );\n        hasTypedArray = true;\n      }\n    });\n    return hasTypedArray ? noTypedArrClone : null;\n  }\n\n\n  /**\n  * Creates a clone, does not alter the original object.\n  * Remove circular dependencies and replace typed arrays by regular arrays.\n  * Both will make the serialization possible and more reliable.\n  * @param {Object} obj - the object to make serialization friendly\n  * @return {Object} a clean clone, or null if nothing was done\n  */\n  static makeSerializeFriendly( obj ){\n    var newObj = obj;\n    var noCircular = CodecUtils.removeCircularReference(newObj);\n\n    if( noCircular )\n      newObj = noCircular;\n\n    var noTypedArr = CodecUtils.replaceTypedArrayAttributesByArrays(newObj);\n\n    if( noTypedArr )\n      newObj = noTypedArr;\n\n    return newObj;\n  }\n\n\n  /**\n  * Check if a string is valid or not. A string is considered as invalid if it has\n  * unicode \"REPLACEMENT CHARACTER\" or non-printable ASCII characters.\n  * @param {String} str - string to test\n  * @param {Boolean} forceAll - test the whole string instead of a sample of 1000 charaters\n  * @return {Boolean} true is the string is valid, false if invalid.\n  */\n  static isValidString( str, forceAll=false ){\n    var strLen = str.length;\n    var nbSamples = forceAll ? strLen : Math.min( 1000, strLen ); //  a sample of 1000 should be enough\n    var flagChar = 0xFFFD;\n    var redFlags = 0;\n    for(var i=0; i<nbSamples; i++){\n      var code = str.charCodeAt( Math.floor(Math.random() * nbSamples) );\n      if( code === flagChar || (code < 32 && code != 10 && code != 13 && code != 9) || code == 127){\n        redFlags ++\n      }\n    }\n    return !(redFlags > 0);\n  }\n\n} /* END of class CodecUtils */\n\nexport { CodecUtils }\n"],"names":["CodecUtils","a","Uint32Array","b","Uint8Array","buffer","byteOffset","byteLength","buff","buffUint8","out","pos","c","length","c1","console","warn","String","fromCharCode","c2","c3","c4","u","code","join","str","p","i","charCodeAt","buf","apply","ArrayBuffer","bufView","strLength","obj","objCleanClone","makeSerializeFriendly","strObj","JSON","stringify","unicodeToArrayBuffer","e","arrayBufferToUnicode","parse","Int8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Float32Array","Float64Array","arrayOfBuffers","totalByteSize","concatArray","offset","set","constructorHost","window","global","arrayType","numberOfElements","Function","BYTES_PER_ELEMENT","slicedBuff","slice","typedArray","type","signed","bytesPerElements","typArrCounter","traverse","forEach","x","isTypedArray","hasCircular","circular","noCircRefObj","map","remove","hasTypedArray","noTypedArrClone","origSize","Object","keys","untypedArray","Array","update","newObj","noCircular","removeCircularReference","noTypedArr","replaceTypedArrayAttributesByArrays","forceAll","strLen","nbSamples","Math","min","flagChar","redFlags","floor","random"],"mappings":"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"}